# org: bohlok
# app: kfru-programs

service: kfru-programs

custom:
  settings:
    ITEMS_DYNAMODB_TABLE: kfru-programs

provider:
  name: aws
  runtime: nodejs12.x
  profile: default
  region: eu-central-1
  environment: ${self:custom.settings}


  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "dynamodb:Query"
        - "dynamodb:GetItem"
        - "dynamodb:PutItem"
        - "dynamodb:UpdateItem"
        - "dynamodb:DeleteItem"
      Resource:
        - "arn:aws:dynamodb:${self:provider.region}:*:table/${self:custom.settings.ITEMS_DYNAMODB_TABLE}"

functions:
  saveProgram:
    handler: handler.saveProgram
    events:
      - http:
          path: program
          method: post
  saveCourse:
    handler: handler.saveCourse
    events:
      - http:
          path: course/{programId}
          method: post
  saveStudent:
    handler: handler.saveStudent
    events:
      - http:
          path: student/{programId}
          method: post
  getCourses:
    handler: handler.getCourses
    events:
      - http:
          path: course/{programId}
          method: get
  # deleteItem:
  #   handler: handler.deleteItem
  #   events:
  #     - http:
  #         path: item/{itemId}
  #         method: delete
  # updateItem:
  #   handler: handler.updateItem
  #   events:
  #     - http:
  #         path: item/{itemId}
  #         method: put


resources:
  Resources:
    ImagesTable:
      Type: "AWS::DynamoDB::Table"
      Properties:
        AttributeDefinitions:
        - AttributeName: "PK"
          AttributeType: "S"
        - AttributeName: "SK"
          AttributeType: "S"
        KeySchema:
        - AttributeName: "PK"
          KeyType: "HASH"
        - AttributeName: "SK"
          KeyType: "RANGE"
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
        TableName: ${self:custom.settings.ITEMS_DYNAMODB_TABLE}